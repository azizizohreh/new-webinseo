<?php/* Template Name: تایید پرداخت */get_header();function update_to_seo_table($refid, $payment_state, $authority){    global $wpdb;    $table_name = $wpdb->prefix . 'seo_request';    $wpdb->update(        $table_name,        array(            'refid' => $refid,            'payment_state' => $payment_state,        ),        array('authority' => $authority)    );}function get_amount($authority){    global $wpdb;    $table_name = $wpdb->prefix . 'seo_request';    $result = $wpdb->get_row("SELECT * FROM `{$table_name}` WHERE authority='{$authority}'");    return $result->amount;}function check(){   global  $MerchantID; //Required   $Authority = $_GET['Authority'];   $Amount =  intval(get_amount($Authority));   if ($_GET['Status'] == 'OK') {       $client = new SoapClient('https://www.zarinpal.com/pg/services/WebGate/wsdl', array('encoding' => 'UTF-8'));       $result = $client->PaymentVerification(           [               'MerchantID' => $MerchantID,               'Authority' => $Authority,               'Amount' => $Amount,           ]       );       if ($result->Status == 100) {           update_to_seo_table($result->RefID.'','تراکنش موفق',$Authority);           return 'تراکنش با موفقیت انجام شد. کد پیگیری: '. $result->RefID;       } else {           update_to_seo_table('','تراکنش ناموفق',$Authority);           return 'تراکنش ناموفق. بعد از 72 ساعت مبلغ شما از طریق بانک به حساب شما بازگردانده می شود، در غیر اینصورت با ما تماس بگیرید.';       }   } else {       update_to_seo_table('','لغو توسط کاربر',$Authority);       return 'تراکنش توسط کاربر لغو شد.';   }}?><main class="page ">    <div class="container">        <?php include ROOT_DIR . '/inc/breadcrumbs.php'; ?>        <h1 class="page-title"><?php the_title(); ?></h1>        <div class="page-content-wrapper">            <div class="thumb">                <?php the_post_thumbnail(); ?>            </div>            <div class="page-content">                <?php the_content(); ?>                <p><?php check(); ?></p>            </div>            <?php comments_template(); ?>        </div>    </div></main><?php get_footer(); ?>